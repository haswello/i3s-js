/**
 * @file Tests for the Compare class
 * @author Tom Jenkins tom@itsravenous.com
 */

// Dependencies
var Compare = require('../src/compare');
var FingerPrint = require('../src/fingerprint');

describe('A spec for the Compare class', function () {

	it('Compares two fingerprints based on two images from the original I3S test data, using the "exhaustive search" method', function () {
		var baasie1 = {
			id: '20030811',
			refs: [
				[333.37620578619, 213.94285714152002],
				[797.08467309373, 256.45714285554004],
				[521.3290460854, 558.17142856794]
			],
			features: [
				[187.95284029921, 429.25714285446],
				[204.41586280717, 440.22857142582],
				[256.54876741571, 448.45714285434],
				[192.0685959262, 555.4285714251],
				[342.9796355825, 481.37142856842],
				[477.42765273084, 434.74285714014],
				[525.44480171239, 441.59999999724005],
				[577.57770632093, 323.65714285512],
				[610.50375133685, 433.37142856872003],
				[1006.98821007022, 377.14285714050004],
				[732.60450160422, 330.51428571222004],
				[926.04501607275, 394.97142856896005],
				[872.54019292188, 405.94285714032003],
				[432.15434083395, 427.88571428304004],
				[214.01929260348, 400.45714285464004],
				[214.01929260348, 419.65714285452003],
				[681.84351553801, 355.19999999778],
				[681.84351553801, 390.85714285470004],
				[1020.70739549352, 329.1428571408],
				[189.32475884154, 529.37142856812],
				[325.14469453221, 352.45714285494],
				[799.5428571428572, 340.11428571428576]
			]
		};

		var baasie2 = {
			id: '20031102a',
			refs: [
				[455.47695605356, 300.34285714098],
				[724.37299035024, 353.82857142636004],
				[558.37084672831, 523.8857142824401]
			],
			features: [
				[362.18649517512, 419.65714285452003],
				[370.4180064291, 431.99999999730005],
				[403.34405144502, 411.428571426],
				[404.71596998735, 437.48571428298004],
				[381.39335476774, 405.94285714032003],
				[451.36120042657, 464.91428571138005],
				[401.97213290269, 486.8571428541],
				[503.49410503511, 421.02857142594],
				[508.98177920443, 438.8571428544],
				[533.67631296637, 445.7142857115],
				[562.4866023553, 452.5714285686],
				[543.27974276268, 404.57142856890005],
				[610.50375133685, 447.08571428292004],
				[786.10932475509, 433.37142856872003],
				[723.00107180791, 397.7142857118],
				[684.58735262267, 396.34285714038003],
				[348.46730975182, 486.8571428541],
				[451.36120042657, 382.62857142618003],
				[469.02857142857147, 453.9428571428572]
			]
		};

		var baasie3 = {
			id: '20031102b',
			refs: [
				[517.21329045841, 311.31428571234],
				[987.7813504776, 425.1428571402],
				[702.42229367296, 704.91428570988]
			],
			features: [
				[322.40085744755, 665.1428571387],
				[333.37620578619, 640.45714285314],
				[360.81457663279, 523.8857142824401],
				[375.90568059842, 545.82857142516],
				[432.15434083395, 512.9142857110801],
				[436.27009646094, 558.17142856794],
				[521.3290460854, 603.4285714248],
				[556.99892818598, 591.08571428202],
				[628.33869238714, 560.9142857107801],
				[676.35584136869, 569.1428571393001],
				[725.74490889257, 582.8571428535],
				[895.86280814149, 512.9142857110801],
				[1079.69989281371, 569.1428571393001],
				[1011.10396569721, 507.42857142540004],
				[1133.20471596458, 566.39999999646],
				[1214.1479099620499, 554.05714285368],
				[1222.37942121603, 511.54285713966004],
				[1116.74169345662, 501.94285713972005],
				[790.22508038208, 469.02857142564005],
				[812.17577705936, 584.22857142492],
				[621.47909967549, 527.9999999967],
				[692.81886387665, 503.31428571114003],
				[445.87352625725, 655.54285713876],
				[428.03858520696, 643.1999999959801],
				[241.45766345008, 588.3428571391801],
				[392.36870310638, 499.19999999688],
				[810.80385851703, 538.97142856806],
				[943.87995712304, 493.71428571120003],
				[262.03644158503, 578.7428571392401],
				[1186.70953911545, 441.59999999724005]
			]
		};

		var tom1 = {
			id: '20031212',
			refs: [
				[246.9453376194, 242.74285714134],
				[794.34083600907, 344.22857142642005],
				[473.31189710385, 617.1428571390001]
			],
			features: [
				[75.45551982815, 462.17142856854],
				[108.38156484407, 393.59999999754],
				[322.40085744755, 437.48571428298004],
				[347.09539120949, 444.34285714008],
				[377.27759914075, 466.28571428280003],
				[292.21864951629, 511.54285713966004],
				[268.89603429668, 536.22857142522],
				[401.97213290269, 501.94285713972005],
				[432.15434083395, 493.71428571120003],
				[499.37834940812, 504.68571428256],
				[543.27974276268, 496.45714285404],
				[428.03858520696, 404.57142856890005],
				[498.00643086579, 379.88571428334],
				[411.575562699, 566.39999999646],
				[380.02143622541, 547.19999999658],
				[668.12433011471, 433.37142856872003],
				[717.51339763859, 429.25714285446],
				[683.21543408034, 397.7142857118],
				[530.93247588171, 419.65714285452003],
				[640.68595926811, 510.17142856824],
				[797.08467309373, 526.62857142528],
				[786.10932475509, 425.1428571402],
				[824.52304394033, 425.1428571402],
				[591.29689174423, 394.97142856896005],
				[558.37084672831, 401.82857142606],
				[554.25509110132, 430.62857142588],
				[578.9496248632599, 429.25714285446],
				[200.30010718018, 559.5428571393601],
				[646.17363343743, 429.25714285446],
				[714.76956055393, 519.77142856818],
				[439.0139335456, 547.19999999658],
				[440.38585208793, 521.1428571396]
			]
		}

		var f1 = new FingerPrint(baasie1.refs, baasie1.features);
		var f2 = new FingerPrint(baasie2.refs, baasie2.features);
		var f3 = new FingerPrint(baasie3.refs, baasie3.features);
		var f4 = new FingerPrint(tom1.refs, tom1.features);

		var comp = new Compare();
		var score = comp.compareTwo(f1, f2);
		var scoreRounded = Math.round(score * 100) / 100;

		expect(scoreRounded).toEqual(9.23);
	});
});